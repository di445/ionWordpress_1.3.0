angular.module("your_app_name.services",[]).service("PostService",function(e,r,o,t,s,n){this.getRecentPosts=function(e){var s=o.defer();return r.jsonp(t+"get_recent_posts/?page="+e+"&callback=JSON_CALLBACK").success(function(e){s.resolve(e)}).error(function(e){s.reject(e)}),s.promise},this.getUserGravatar=function(e){var s=o.defer();return r.jsonp(t+"user/get_avatar/?user_id="+e+"&type=full&callback=JSON_CALLBACK").success(function(e){var r=e.avatar.replace("http:",""),o="http:"+r;s.resolve(o)}).error(function(e){s.reject(e)}),s.promise},this.getPost=function(e){var s=o.defer();return r.jsonp(t+"get_post/?post_id="+e+"&callback=JSON_CALLBACK").success(function(e){s.resolve(e)}).error(function(e){s.reject(e)}),s.promise},this.submitComment=function(e,n){var i=o.defer(),a=s.getUser();return r.jsonp(t+"user/post_comment/?post_id="+e+"&cookie="+a.cookie+"&comment_status=1&content="+n+"&callback=JSON_CALLBACK").success(function(e){i.resolve(e)}).error(function(e){i.reject(e)}),i.promise},this.getPostsFromCategory=function(e,s){var n=o.defer();return r.jsonp(t+"get_category_posts/?id="+e+"&page="+s+"&callback=JSON_CALLBACK").success(function(e){n.resolve(e)}).error(function(e){n.reject(e)}),n.promise},this.shortenPosts=function(e){var r=600;return _.map(e,function(e){if(e.content.length>r){var o=e.content.substr(0,r);o=o.substr(0,Math.min(o.length,o.lastIndexOf("</p>"))),e.content=o}return e})},this.sharePost=function(e){window.plugins.socialsharing.share("Check this post here: ",null,null,e)},this.bookmarkPost=function(r){n.bookmarkPost(r),e.$broadcast("new-bookmark",r)},this.getWordpressPage=function(e){var s=o.defer();return r.jsonp(t+"get_page/?slug="+e+"&callback=JSON_CALLBACK").success(function(e){s.resolve(e)}).error(function(e){s.reject(e)}),s.promise}}).service("SearchService",function(e,r,o,t){this.search=function(e){var r=[],t=o.defer(),s=[this.searchPosts(e),this.searchTags(e),this.searchAuthors(e)];return o.all(s).then(function(e){_.map(e,function(e){r.push({_id:e.id,results:_.map(e.posts,function(e){return{title:e.title,id:e.id,date:e.date,excerpt:e.excerpt}})})}),t.resolve(r)}),t.promise},this.searchPosts=function(e){var s=o.defer();return r.jsonp(t+"get_search_results/?search="+e+"&callback=JSON_CALLBACK").success(function(e){var r={id:"posts",posts:e.posts};s.resolve(r)}).error(function(e){s.reject(e)}),s.promise},this.searchTags=function(e){var s=o.defer(),n=o.defer();return r.jsonp(t+"get_tag_index/?callback=JSON_CALLBACK").success(function(r){var o=_.filter(r.tags,function(r){return r.title.indexOf(e)>-1});s.resolve(o)}).error(function(e){s.reject(e)}),s.promise.then(function(e){var s=_.map(e,function(e){return r.jsonp(t+"get_tag_posts/?id="+e.id+"&callback=JSON_CALLBACK")});o.all(s).then(function(e){var r=[];_.map(e,function(e){_.each(e.data.posts,function(e){r.push(e)})});var o={id:"tags",posts:r};n.resolve(o)})}),n.promise},this.searchAuthors=function(e){var s=o.defer(),n=o.defer();return r.jsonp(t+"get_author_index/?callback=JSON_CALLBACK").success(function(r){var o=_.filter(r.authors,function(r){return r.name.indexOf(e)>-1||r.nickname.indexOf(e)>-1||r.first_name.indexOf(e)>-1});s.resolve(o)}).error(function(e){s.reject(e)}),s.promise.then(function(e){var s=_.map(e,function(e){return r.jsonp(t+"get_author_posts/?id="+e.id+"&callback=JSON_CALLBACK")});o.all(s).then(function(e){var r=[];_.map(e,function(e){_.each(e.data.posts,function(e){r.push(e)})});var o={id:"authors",posts:r};n.resolve(o)})}),n.promise}}).service("BookMarkService",function(e){this.bookmarkPost=function(r){var o=e.isUndefined(window.localStorage.ionWordpress_bookmarks)?[]:JSON.parse(window.localStorage.ionWordpress_bookmarks),t=e.find(o,function(e){return e.id==r.id});t||o.push({id:r.id,title:r.title,date:r.date,excerpt:r.excerpt}),window.localStorage.ionWordpress_bookmarks=JSON.stringify(o)},this.getBookmarks=function(){return JSON.parse(window.localStorage.ionWordpress_bookmarks||"[]")},this.remove=function(r){var o=e.isUndefined(window.localStorage.ionWordpress_bookmarks)?[]:JSON.parse(window.localStorage.ionWordpress_bookmarks),t=e.filter(o,function(e){return e.id!=r});window.localStorage.ionWordpress_bookmarks=JSON.stringify(t)}}).service("PushNotificationsService",function(e,r,o,t,s,n){this.register=function(){if(ionic.Platform.isIOS()){var i={badge:!0,sound:!0,alert:!0};o.register(i).then(function(e){console.log("Registration OK: "+e),t.storeDeviceToken("ios",e)},function(e){console.log("Registration error: "+e)}),e.$on("$cordovaPush:notificationReceived",function(e,o){console.log("Recieve push notification with notification.relatedvalue: "+o.relatedvalue),o.relatedvalue&&(n.nextViewOptions({disableAnimate:!0}),r.go("app.post",{postId:o.relatedvalue}))})}else if(ionic.Platform.isAndroid()){var a={senderID:s};o.register(a).then(function(e){console.log("result: "+e)},function(e){console.log("error: "+e)}),e.$on("$cordovaPush:notificationReceived",function(e,o){switch(o.event){case"registered":o.regid.length>0&&t.storeDeviceToken("android",o.regid);break;case"message":console.log("message = "+o),o.payload.relatedvalue&&(n.nextViewOptions({disableAnimate:!0}),r.go("app.post",{postId:o.payload.relatedvalue}));break;case"error":}})}}}).service("AuthService",function(e,r,o,t){this.validateAuth=function(e){var s=o.defer();return r.jsonp(t+"user/validate_auth_cookie/?cookie="+e.cookie+"&callback=JSON_CALLBACK").success(function(e){s.resolve(e)}).error(function(e){s.reject(e)}),s.promise},this.doLogin=function(e){var r=o.defer(),t=o.defer(),s=this;return s.requestNonce("user","generate_auth_cookie").then(function(e){t.resolve(e)}),t.promise.then(function(o){s.generateAuthCookie(e.userName,e.password,o).then(function(e){if("error"==e.status)r.reject(e.error);else{var o={cookie:e.cookie,data:e.user,user_id:e.user.id};s.saveUser(o),s.updateUserAvatar().then(function(){r.resolve(o)})}})}),r.promise},this.doRegister=function(e){var r=o.defer(),t=o.defer(),s=this;return s.requestNonce("user","register").then(function(e){t.resolve(e)}),t.promise.then(function(o){s.registerUser(e.userName,e.email,e.displayName,e.password,o).then(function(o){"error"==o.status?r.reject(o.error):s.doLogin(e).then(function(){r.resolve(e)})})}),r.promise},this.requestNonce=function(e,s){var n=o.defer();return r.jsonp(t+"get_nonce/?controller="+e+"&method="+s+"&callback=JSON_CALLBACK").success(function(e){n.resolve(e.nonce)}).error(function(e){n.reject(e.nonce)}),n.promise},this.doForgotPassword=function(e){var s=o.defer();return r.jsonp(t+"user/retrieve_password/?user_login="+e+"&callback=JSON_CALLBACK").success(function(e){s.resolve(e)}).error(function(e){s.reject(e)}),s.promise},this.generateAuthCookie=function(e,s,n){var i=o.defer();return r.jsonp(t+"user/generate_auth_cookie/?username="+e+"&password="+s+"&nonce="+n+"&callback=JSON_CALLBACK").success(function(e){i.resolve(e)}).error(function(e){i.reject(e)}),i.promise},this.saveUser=function(e){window.localStorage.ionWordpress_user=JSON.stringify(e)},this.getUser=function(){var e=window.localStorage.ionWordpress_user?JSON.parse(window.localStorage.ionWordpress_user).data:null,r=window.localStorage.ionWordpress_user?JSON.parse(window.localStorage.ionWordpress_user).cookie:null;return{avatar:JSON.parse(window.localStorage.ionWordpress_user_avatar||null),data:e,cookie:r}},this.registerUser=function(e,s,n,i,a){var c=o.defer();return r.jsonp(t+"user/register/?username="+e+"&email="+s+"&display_name="+n+"&user_pass="+i+"&nonce="+a+"&callback=JSON_CALLBACK").success(function(e){c.resolve(e)}).error(function(e){c.reject(e)}),c.promise},this.userIsLoggedIn=function(){var e=o.defer(),r=JSON.parse(window.localStorage.ionWordpress_user||null);return null!==r&&null!==r.cookie?this.validateAuth(r).then(function(r){e.resolve(r.valid)}):e.resolve(!1),e.promise},this.logOut=function(){window.localStorage.ionWordpress_user=null,window.localStorage.ionWordpress_user_avatar=null},this.updateUserAvatar=function(){var e=o.defer(),s=this,n=JSON.parse(window.localStorage.ionWordpress_user||null);return r.jsonp(t+"user/get_avatar/?user_id="+n.user_id+"&type=full&callback=JSON_CALLBACK").success(function(r){var o=r.avatar.replace("http:",""),t="http:"+o;window.localStorage.ionWordpress_user_avatar=JSON.stringify(t),e.resolve(t)}).error(function(r){e.reject(r)}),e.promise}});